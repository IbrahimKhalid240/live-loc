<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Loc Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    body.dark-mode {
      background-color: #000 !important;
      color: #fff !important;
    }
    #map {
      height: 300px;
      width: 100%;
      margin-top: 15px;
    }
    .fade-modal {
      animation: fadeInOut 2s ease forwards;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: scale(0.9); }
      20% { opacity: 1; transform: scale(1); }
      80% { opacity: 1; }
      100% { opacity: 0; transform: scale(0.9); }
    }
    .theme-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 1000;
    }
    .theme-toggle i {
      font-size: 22px;
      cursor: pointer;
      margin-left: 10px;
    }
    .theme-toggle .fa-sun {
      color: #f9d71c;
    }
    .theme-toggle .fa-moon {
      color: #ccc;
    }
    /* Toast-style notification */
    #refreshNotification {
      z-index: 1055;
      display: none;
    }
  </style>
</head>
<body class="bg-light d-flex justify-content-center align-items-center vh-100">

<!-- Theme Toggle -->
<div class="theme-toggle">
  <i id="sunIcon" class="fas fa-sun" title="Light Mode"></i>
  <i id="moonIcon" class="fas fa-moon" title="Dark Mode"></i>
</div>

<!-- Toast-style Notification -->
<div id="refreshNotification" class="position-fixed top-0 start-50 translate-middle-x mt-3 px-4 py-2 bg-success text-white rounded shadow fade-modal">
  Page is refreshed
</div>

<!-- Main Content -->
<div id="main-content" class="text-center">
  <h3>Live-Loc Checker</h3>
  <button class="btn btn-primary mt-3" onclick="startLocation()">Check Here!</button>
</div>

<!-- JS: Bootstrap + Leaflet -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  let originalHTML;
  let isDarkMode = false;

  // Theme toggle
  document.getElementById('moonIcon').addEventListener('click', () => {
    document.body.classList.add('dark-mode');
    isDarkMode = true;
  });

  document.getElementById('sunIcon').addEventListener('click', () => {
    document.body.classList.remove('dark-mode');
    isDarkMode = false;
  });

  function startLocation() {
    originalHTML = document.getElementById('main-content').innerHTML;
    document.getElementById('main-content').innerHTML = `
      <div class="text-primary">
        <span class="spinner-border spinner-border-sm me-2"></span>
        Fetching your Location...
      </div>
    `;
    setTimeout(showMap, 3000);
  }

  function showMap() {
    navigator.geolocation.getCurrentPosition(async (position) => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      let locationText = "Loading...";
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
        const data = await response.json();
        locationText = data.display_name || "Location not found";
      } catch (e) {
        locationText = "Unable to fetch location name";
      }

      document.getElementById('main-content').innerHTML = `
        <h5>Here you are:-</h5>
        <div id="map"></div>
        <p class="mt-2"><strong>${locationText}</strong></p>
        <div class="d-flex justify-content-center gap-3 mt-3">
          <button class="btn btn-warning" onclick="refreshMap()">Check Again</button>
          <button class="btn btn-secondary" onclick="goBack()">Go Back</button>
        </div>
      `;

      const map = L.map('map').setView([lat, lon], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);

      L.marker([lat, lon]).addTo(map).bindPopup("You are here").openPopup();

      setTimeout(() => {
        map.setView([lat, lon], 15, {
          animate: true,
          duration: 1.5
        });
      }, 500);
    }, () => {
      document.getElementById('main-content').innerHTML = `<div class="text-danger">Location permission denied!</div>`;
    });
  }

  function refreshMap() {
    const notification = document.getElementById('refreshNotification');
    notification.style.display = 'block';

    // Let the animation run fully before hiding it
    setTimeout(() => {
      notification.style.display = 'none';
      showMap();
    }, 2000);
  }

  function goBack() {
    document.getElementById('main-content').innerHTML = originalHTML;
  }
</script>

</body>
</html>
